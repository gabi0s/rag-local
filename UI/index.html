<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RAG Local UI</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="app">
    <!-- LEFT: Docs -->
    <aside class="sidebar" aria-label="Documents">
      <div class="brand">
        <div class="logo" aria-hidden="true">RL</div>
        <div class="brand-text">
          <div class="brand-title">RAG Local</div>
          <div class="brand-sub">Docs • Ingestion • Chat</div>
        </div>
      </div>

      <div class="sidebar-actions">
        <button class="btn btn-ghost" id="refreshDocs" type="button" title="Rafraîchir la liste">
          <span class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M20 12a8 8 0 0 1-14.8 4.4M4 12a8 8 0 0 1 14.8-4.4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M20 4v6h-6M4 20v-6h6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          Refresh
        </button>

        <button class="btn btn-ghost" id="openRightPanel" type="button" title="Ouvrir le panneau (mobile)">
          <span class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M5 6h14M5 12h14M5 18h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </span>
          Panel
        </button>
      </div>

      <div class="sidebar-section-title">Documents indexés</div>
      <ul class="doc-list" role="list" id="docList"></ul>

      <div class="sidebar-footer">
        <div class="hint">
          Astuce : ajoute des fichiers dans <b>Ingestion</b>, puis lance <b>Run ingest</b>.
        </div>
      </div>
    </aside>

    <!-- CENTER: Chat -->
    <main class="chat" aria-label="Chat">
      <header class="chat-header">
        <div class="chat-header-left">
          <div class="chat-title-row">
            <div class="chat-title">Assistant</div>
            <span class="badge" id="connBadge" title="État backend">●</span>
          </div>
          <div class="chat-subtitle">Streaming + sources (RAG local)</div>
        </div>

        <div class="chat-header-right">
          <button class="btn btn-ghost" id="newChat" type="button" title="Nouveau chat">
            <span class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </span>
            New chat
          </button>

          <button class="btn btn-danger" id="stopStream" type="button" title="Stop streaming" disabled>
            <span class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none">
                <path d="M7 7h10v10H7z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
              </svg>
            </span>
            Stop
          </button>
        </div>
      </header>

      <section class="chat-body" id="chatBody" aria-live="polite" aria-label="Messages">
        <div class="empty-state" id="emptyState">
          <div class="empty-title">Pose une question.</div>
          <div class="empty-sub">
            Le modèle répond en streaming et affiche les sources utilisées à droite.
          </div>
          <div class="empty-chips">
            <button class="chip" type="button" data-prompt="Résume les documents disponibles.">Résumer les docs</button>
            <button class="chip" type="button" data-prompt="Quelles sont les sources les plus pertinentes ?">Sources pertinentes</button>
            <button class="chip" type="button" data-prompt="Donne-moi un plan d'action pour améliorer l'ingestion.">Améliorer l’ingestion</button>
          </div>
        </div>
      </section>

      <form class="chat-input" id="chatForm" autocomplete="off">
        <div class="input-wrap">
          <textarea
            id="chatText"
            rows="1"
            placeholder="Écris ton message… (Entrée pour envoyer, Shift+Entrée pour une nouvelle ligne)"
            aria-label="Message"
          ></textarea>
          <div class="input-actions">
            <button class="btn btn-primary" type="submit" id="sendBtn" title="Envoyer">
              <span class="icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M4 12l16-8-6 16-2-6-8-2z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                </svg>
              </span>
              Send
            </button>
          </div>
        </div>
        <div class="input-hint">
          <span id="typingHint">Prêt.</span>
          <span class="sep">•</span>
          <span id="charCount">0</span>
          <span class="muted">caractères</span>
        </div>
      </form>
    </main>

    <!-- RIGHT: Sources + Ingestion -->
    <aside class="sidepanel" id="rightPanel" aria-label="Panneau latéral">
      <div class="panel">
        <div class="panel-head">
          <div class="panel-title">Sources</div>
          <button class="btn btn-ghost btn-sm" id="clearSources" type="button" title="Effacer les sources">Clear</button>
        </div>
        <ul class="sources-list" id="sourcesList"></ul>
      </div>

      <div class="panel">
        <div class="panel-head">
          <div class="panel-title">Ingestion</div>
          <span class="pill" id="ingestPill">idle</span>
        </div>

        <div class="field">
          <label for="fileInput">Ajouter des documents</label>
          <input id="fileInput" type="file" multiple />
        </div>

        <div class="field-row">
          <div class="field">
            <label for="chunkSize">Chunk size</label>
            <input id="chunkSize" type="number" min="200" max="4000" value="900" />
          </div>
          <div class="field">
            <label for="chunkOverlap">Overlap</label>
            <input id="chunkOverlap" type="number" min="0" max="1000" value="150" />
          </div>
        </div>

        <button class="btn btn-primary full" id="runIngest" type="button">
          <span class="icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none">
              <path d="M12 2v8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M8 8l4 4 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M4 14v4a4 4 0 0 0 4 4h8a4 4 0 0 0 4-4v-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </span>
          Run ingest
        </button>

        <div class="status" id="ingestStatus"></div>
      </div>

      <button class="panel-close btn btn-ghost" id="closeRightPanel" type="button" aria-label="Fermer le panneau">
        Fermer
      </button>
    </aside>

    <div class="toast" id="toast" role="status" aria-live="polite"></div>
  </div>

  <script src="app.js"></script>
</body>
</html>
